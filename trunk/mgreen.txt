
--------------

Julian Matienzo Notes 

6 days of work to get almost back to where we were before, but with all the new symbol layout ideas.  

We've lost that symbols preview window and gained a little panel on the left with all the symbol names which you can click on.  Automatic icons of the type we had before are not going to work in the long term.  

--------------

Symbols are now done with an extra level of indirection.  You can only include rsymbols in the diagram, and rsymbols are made up from one or more of the original symbols type with many positional attributes.  This is what's missing from a catalogue of acceptable cave symbols -- information about how the official symbols are laid out.  

See the file symbols/symbols.xml for the format.  eg:

<symbolaut dname="bJ7" buttonaction="append" description="7 pulled back boulders">
	<asymbol name="boulder4" position="pullback" scale="fixed" orientation="random" multiplicity="5"/>
</symbolaut>

We will have to make a detailed study of what the options should be.  Other attributes can be "filled", "nonarea", "overlaps-allowed".   

--------------

I have not got everything working automatically yet.  Important parts of the process are happening during loading and editing, but there's a small snag.  

You can enter symbols by clicking on those buttons above the linestyle.  These fill in the label with the appropriate symbol.  You can only do this on connective lines.  The axis of the symbol is the final leg of the symbol path.  


I've put the to-be-automated functions under the "Auto".  

You need to click on "Auto" | "Set NodeZ" to set the z-values on all the nodes by connective proximity.  These are then inherited by the areas.  When you add more paths, the connectivity changes, but this doesn't update automatically. 

You need to click on "Auto" | "Update SAreas" to generate the areas from the path connectivity.  

You need then to click on "Auto" | "Update Symbols Lay" to fit the symbols into the appropriate areas.  The code behind this is still the same, but could be much speeded up by making use of bitmaps rather than boolean shape technology.  

"Detail render" is as before.  I could want to lose this function and change it to a set of switches.  


The snag with getting these features happening automatically is the fact that you can change the linestyle, which buggers up all the connectivity calculations.  I am unsatisfied with the line-style interface; when you draw a line you almost always know what style it should be, but it's annoying to force people to set it before they start drawing.  Hence the need for changing it.  

If we find an interface that makes the linestyle less fluid, I could get these calculations of areas going dynamically without too much difficulty.  

--------------

The connectivity areas where the symbols lie is according to your specifications.  Once you have the symbols updated, select a connecting path with some symbols on it and press on the "Update SAreas" button.  This will paint just the area which the symbol lies within.  

See if it works the way you think it should.  Also, see if it's not too much of a real pain -- ie that this has not been a real bad idea.  

--------------

Some areas for optimization: 

   Everything is loaded at the same time.  Better performance if the sketches were not loaded until needed.  

   The backimage really really needs attention.  It uses too much memory, and there are lots of java features I've not looked at enough, and will do.  It can automatically change the contrast and grey scale.  One good idea is to put an os map as a background of the main picture.  

--------------

Distortion not yet been done by connectivity.  Will follow shortly when this is sound.  Possibly the image stuff is the most pressing for now.  For interest, it should also be poss to clip out pieces of the back-bitmap and render it in the area, for fast results without drawing up the whole survey.  

To make an impression, should also think about a good colour scheme; some kind of shading of the passages (or around the outside of the passages) that looks attractive on a large scale.  

We can try some out, and any good results I'll pay for one of those A0 glossy colour posters printed off in Liverpool uni.  


Other feature: with some thought, we could standardize the question-mark notation and make it possible to dump out a complete report from the survey, with location and comments.  

We should also aim to put out a sort of image on the web that is entirely hyper-linked by section to survey notes and question-marks.  The hyperlinks should go backwards too from survey notes and question marks, to the position in the cave.  


-------------
--------------


List of things to do. *urgent +preferable

Extras

+ copy down the official symbols
+ review the symbol options 
+ don't load everything at once 
+ get images working properly (and with a separate path variable) 
+ review the changeability of the linetypes 
+ make everything update automatically 
+ symbol layout done using bitmap technology.  
+ slicing along planes other than z and other means 
+ rendering above and below passages, and hidden kinds in grey.  



Connectivity:

* Morph by connectivity

Lines:

+ Spline across nodes
+ Length and direction of lines on side bar for drawing to scale
+ Fix number of grid size


Symbols:
+ Real time update SAreas?
+ Real time update symbol layers?
* Symbol type that fills area it occupies


Saving:
+ Warning if not all files saved when exiting
+ Option to delete files within tunnel
+ Allow files to be saved separately
+ back up file before saving
+ MsgBox if save not successful
+ Do not over write files if save unsucesfull.
+ Remove * when sketches saved


Line types:
+ Cross section line, either connected by a line to the cross section or with a reference to the cross section.






Bug reports:


This is what happens when you try to load merrygoround3/meerygoround3-sketch0.xml Then some of the lines come up for that survey.

dateorder 112 merrygoround3 Loading new backimage c:\cygwin\home\mjg54\surveys\204survey\204\merrygoround3\. .\..\..\2002#24\plan.png sun.awt.windows.WImage@6c5482 backimgdraw 0 java.lang.NullPointerException image bits 3 8 4 64 at Tunnel.OneSketch.paintW(OneSketch.java:1050)
       at Tunnel.SketchGraphics.paintComponent(SketchGraphics.java:442)
       at javax.swing.JComponent.paint(JComponent.java:808)

       at javax.swing.JComponent.paintChildren(JComponent.java:647)
       at javax.swing.JComponent.paint(JComponent.java:817)
       at javax.swing.JComponent.paintChildren(JComponent.java:647)
       at javax.swing.JSplitPane.paintChildren(JSplitPane.java:1021)
       at javax.swing.JComponent.paint(JComponent.java:817)
       at javax.swing.JComponent.paintChildren(JComponent.java:647)
       at javax.swing.JComponent.paint(JComponent.java:817)
       at javax.swing.JComponent.paintChildren(JComponent.java:647)
       at javax.swing.JComponent.paint(JComponent.java:817)
       at javax.swing.JLayeredPane.paint(JLayeredPane.java:552)
       at javax.swing.JComponent.paintChildren(JComponent.java:647)
       at javax.swing.JComponent.paintWithOffscreenBuffer(JComponent.java:4778)

       at javax.swing.JComponent.paintDoubleBuffered(JComponent.java:4724)
       at javax.swing.JComponent.paint(JComponent.java:798)
       at java.awt.GraphicsCallback$PaintCallback.run(GraphicsCallback.java:21)

       at sun.awt.SunGraphicsCallback.runOneComponent(SunGraphicsCallback.java: 60)
       at sun.awt.SunGraphicsCallback.runComponents(SunGraphicsCallback.java:97 )
       at java.awt.Container.paint(Container.java:1309)
       at sun.awt.RepaintArea.paint(RepaintArea.java:177)
       at sun.awt.windows.WComponentPeer.handleEvent(WComponentPeer.java:260)
       at java.awt.Component.dispatchEventImpl(Component.java:3699)
       at java.awt.Container.dispatchEventImpl(Container.java:1623)
       at java.awt.Window.dispatchEventImpl(Window.java:1590)
       at java.awt.Component.dispatchEvent(Component.java:3480)
       at java.awt.EventQueue.dispatchEvent(EventQueue.java:450)
       at java.awt.EventDispatchThread.pumpOneEventForHierarchy(EventDispatchTh read.java:197)
       at java.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThre ad.java:150)
       at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:144)

       at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:136)

       at java.awt.EventDispatchThread.run(EventDispatchThread.java:99)
image allbits there
making new backimage
new backimagedone
backimgdraw 1
java.lang.NullPointerException
       at Tunnel.OneSketch.paintW(OneSketch.java:1050)
       at Tunnel.SketchGraphics.paintComponent(SketchGraphics.java:442)
       at javax.swing.JComponent.paint(JComponent.java:808)
       at javax.swing.JComponent.paintWithOffscreenBuffer(JComponent.java:4771)

       at javax.swing.JComponent.paintDoubleBuffered(JComponent.java:4724)

