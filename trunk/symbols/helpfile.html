<h1>Drawing</h1>

<p>Click the <b>Left Mouse Button</b> in the graphics pane whilst (optionally) holding down the <em>Shift</em> or <em>Control</em> keys.</p>
<ul>
<li><b>Shift</b> + <b>Left Mouse</b> ends a path</li>
<li><b>Control</b> + <b>Left Mouse</b> starts or ends on a node</li>
<li><b>Shift+Control</b> + <b>Left Mouse</b> inserts a node on a selected path</li>
</ul>
<p>The drop-down box in the top left of the window (or single letter buttons <tt>'W' 'E' 'P' 'C' 'D' 'I' 'N' 'F'</tt>) 
sets the type of the selected path, with <tt><b>'S'</b></tt> controlling the spline.  Buttons:</p>
<ul>
<li><b>Delete</b> acts on any number of selected paths</li>
<li><b>Back</b> undo last click or button</li>
<li><b>Reflect</b> reverses direction of the selected path</li>
<li><b>Fuse</b> joins two selected paths</li>
</ul>
<p>The <b>img</b> tab has a <b>Snap to grid</b> feature where you can change the grid spacing.</p>
<p>Centreline paths cannot be deleted without setting the menu <b>Action</b> -&gt; <b>Allow Delete Centreline</b>.</p>
<p>The <em>Pitch Bound</em> and <em>Ceiling Bound</em> paths have a dash on one side to show the direction of the 
'whiskers' (always to the right according to the direction it was drawn).  Click <b>Reflect</b> to reverse it.</p>
<p>Connecting to the correct node among an overlapping set (some will be drawn as diamonds and pentagons) 
is possible by dragging away from the <em>Control+Left Mouse</em> selected node without releasing it in 
order to select the next one.</p>


<h1>Viewing</h1>

<p>Click and drag with the <b>Middle Mouse Button</b> to move the viewing position.  
Zoom with the <b>Scroll-wheel</b> or by holding the <b>Control-key</b> 
down before you click and drag the middle mouse.</p>

<p>The <b>View</b> menu contains the <b>Max</b> feature, and <b>Display</b> can turn on station names.  
Change the thickness of the lines using the <b>Stroke</b> buttons. 
Draw the final result with <b>Detail render</b>.</p>

<p>The <b>view</b> tab shows a second pane where you can store the current view using the <b>Copy</b> button.</p>


<h1>Selecting</h1>

<p>Click the <b>Right Mouse Button</b> on the desired path 
whilst (optionally) holding down the <em>Shift</em> or <em>Control</em> keys.  
Multiple clicks cycle through the overlapping paths.</p>
<ul>
<li><b>Control</b> + <b>Right Mouse</b> selects (or deselects) multiple paths</li>
<li><b>Shift</b> + <b>Right Mouse</b> selects all paths for an area</li>
</ul>
<p>The <b>Component</b> button selects all paths that connect to the selected path(s).  
Click <b>Component</b> again to select all paths to one side of the selected path(s).</p>

<p>Fuse and fuse translate</p>


<h1>Centreline</h1>

<p>TunnelX is <em>Survex</em> based.  (see http://www.survex.com)
Either use <b>Import</b> -&gt; <b>Import survex file</b> to load the centreline data, or 
do <b>File</b> -&gt; <b>Open survex...</b> from the Main window.  
The centreline data can be previewed by selecting the dotted green (connective) 'S' to see the label text, 
or do <b>Import</b> -&gt; <b>Wireframe view</b> to see the centreline in <em>Survex-Aven<em>.</p>

<p>If <em>Survex</em> is not found, <b>Import</b> -&gt; <b>Use Survex</b> should be disabled, 
and TunnelX's computation (without loop closures) will be used.</p>

<p>Do <b>Import</b> -&gt; <b>Import centreline</b> to load the geometry defined by the <em>Survex</em> data.</p>



<h1>Backgrounds</h1>

<p>Select the <b>img</b> tab for loading and moving the background image.
<b>Add image</b> adds a new image to the background.</p>

<p><b>Select image</b> requires the rectangle outline of an image to be selected.  
Alternatively, use the drop-down box of visible background images.</p>

<p>Move the selected image into position by drawing a single line path and clicking 
on the <b>Shift ground</b> button.  
Rotate and resize the image by drawing a three point (two line) path before clicking 
<b>Shift ground</b> -- 
the first point is the centre of rotation while the second point is moved to the third point.</p>

<p>Always connect the corner of the rectangle outline of the image to part of the passage 
it depicts so that it stays in place when the passage moves.</p>

<p><em>Not done yet:</em> It will be possible to draw smaller areas to trim out from the 
big rectangular paper to show only what is required and to make it possible to render multiple background 
images without too much undesirtable overlapping.  
This may also be used to bring together scattered cross-sectional outlines.</p>


<h1>Files</h1>

<p>The Main window show the list of sketch files.  
Double-click (or select it and do <b>Tunnel</b> -&gt; <b>View sketch</b>) to work on the drawing.
Open a new file using <b>File</b> -&gt; <b>Open sketch...</b>.</p>

<p>The file name is <em>green</em> when it is loaded and up to date, 
and <em>red</em> if it needs to be saved.</p>  
From the drawing window, use <b>File</b> -&gt; <b>Save as...</b> to give it a different name.</p>

<p>To copy another sketch into the current sketch (while distorting to fit the centreline), 
select it in the Main window and do <b>Import</b> -&gt; <b>Import down sketch</b>.  
Always preview the import using <b>Preview down sketch</b>.</p>

<p>Sketches can be downloaded from the internet by pasting their 'http://...' url into the file open dialog.</p>


<h1>Areas</h1>

<p>The <b>Update areas</b> button creates the areas of the sketch by finding the 
closed outlines of series of paths that are properly joined up at their nodes.  
Paths of type <em>Centreline</em> and <em>Connective</em> are ignored, 
but <em>Invisible</em> paths count.  

Preview the areas with <b>Display</b> -&gt; <b>Stripe areas</b>.  
If areas do not appear, check for failed joins or unintended crossings near nodes, 
and that the area itself does not self-intersect.</p>

<p>Disconnected features or rock pillars within an area must be joined with an 
<em>Invisible</em> path.  
The filling in of a rock pillar is disabled by drawing a <em>Connective</em> path 
into it from one of the nodes, clicking <b>Area signal</b> 
and selecting <em>rock</em> from the drop-down box.  
Then do <b>Update areas</b> to refresh.</p>


<h1>Z-depth</h1>

<p>The altitude of the paths and nodes are defined by the average of the nearest three centreline stations 
(by connectivity).  Compute this by clicking the <b>Update Node Z</b> button.  
The areas will be sorted by their average altitude and rendered in order.</p>

<p>Paths (and their areas) can be forced to a relative altitude by connecting them 
by a <em>Connective</em> line to a centreline node, clicking <b>Area signal</b>, 
selecting <em>zsetrelative</em> and changing the <tt>0.0</tt> to 
a different displacement.</p>

<p>Select a <em>Pitch Boundary</em> type path and do <b>Action</b> -&gt; <b>Pitch Undercut</b> to 
create an  <em>Invisible</em> path beneath it connected by two <em>Connective</em> paths, 
which can be used for connecting a passage that breaks through the wall below the pitch.
This is necessary because you cannot connect three areas to one path.</p>

<p>Select an area and do <b>Display</b> -&gt; <b>Thin Z Selection</b> to restrict the 
drawing to a Z-range close to that which was selected.  
Expand this visible area using <b>Display</b> -&gt; <b>Widen Z Selection</b>.  
A vertical bar on the left of the graphics area depicts the Z-region in view and selected.
</p>

<p>The altitudes of centreline stations can be shown using <b>Display</b> -&gt; <b>Station Altitudes</b>.
Do <b>Colour</b> -&gt; <b>Height</b> to fill in a colour spectrum of heights those visible in the 
graphics window at the time (zoom in to a small section of the cave to exaggerate the colour spread for that part).</p>


<h1>Symbols</h1>

<p>Symbols are placed on <em>Connective</em> paths.  
They are always part of the area they point into from the node they join 
(though the rest of the path can go outside the area).</p>

<p>Click on <b>Add Symbols</b> and select the chosen symbol.  
Some are single symbols (eg stalactite, straws), 
directional (eg slope, stream), 
and the rest are area filling (eg puddle, boulders).
To render, first <b>Update Areas</b> to bind the symbols into the correct area, 
and then <b>Update Symbols</b> to lay them out.</p>

<p>The <b>subs</b> tab allows for setting the subset style for rendering the symbols to different scales.</p>


<h1>Symbol files</h1>

<p>The symbols directory contains all the basic symbols in the form of little sketches 
(eg a single boulder, one stream arrow, etc).  You can see and edit them them by doing 
<b>Tunnel</b> -&gt; <b>Symbols list</b> from the MainBox.</p>

<p>The <em>fontcolours.xml</em> files contain the real work of defining what happens 
for each Subset Style.  For example, the baseSymbols250 style defines:</p>

<p><tt>&lt;symbolaut dname="stream" description="stream symbol" multiplicity="1" buttonaction="overwrite" area-interaction="allowed-outside" position="endpath" scale="fixed" orientation="fixed">
   &lt;asymbol name="stream" picscale="0.5" orientation="nearaxis"/>
&lt;/symbolaut>
</tt></p>

<p>The <em>symbols</em> directory will be loaded from <tt>[current-directory]/symbols</tt> if it exists, or 
<tt>[home-directory]/.tunnelx/symbols</tt> (if in unix) or <tt>[home-directory]/symbols</tt> (if in windows), 
or finally <tt>/usr/share/tunnelx/symbols/</tt>.  If none of these exist, it will use the symbols directory 
that comes with the <em>.jar</em> file.</p>


<h1>Labels</h1>

<p>Labels are placed on <em>Connective</em> paths.  
Click on <b>Write Text</b> and write the label in the text area, 
selecting the type of label from the drop down box.</p>

<p>The origin position is located at the first node of the path.  
The 3x3 choice matrix sets which corner or side of the box containing the 
text is placed on the origin.  
Fine positioning can be done by drawing a short path from the first node 
and clicking <b>Fuse</b>.</p>

<p>Always connect one end to the associated passage so it stays with in place 
when the passage is moved.</p>

<p>Use the <b>Arrow</b> selection to point at one end, and 
the <b>Box</b> to further highlight a label.</p>


<h1>Scale bars</h1>

<p>Paste one of the following blocks of text into a label to produce a scale bar.  Simple version:</p>

<tt><ul>
<li>%10/1.0000%%whiterect%</li>
<li>;%10/%%blackrect%</li>
<li>;%10/%%whiterect%</li>
<li>;%10/%%blackrect%</li>
<li>;%10/%%whiterect%</li>
<li>%v1.0/1%</li>
<li>%10/%0m</li>
<li>;%10/%10m</li> 
<li>;%10/%20m</li>
<li>;%10/%30m</li>
<li>;%10/%40m</li>
<li>;%10/%50m</li>
</ul></tt>

<p>Complex scale bar:</p>

<tt><ul>
<li>%0/1.0000%%v0/%</li>
<li>;%50/%%v1/%%whiterect%</li>
<li>%1/%%v0.5/%</li>
<li>;%1/%%v0.5/%%blackrect%</li>
<li>;%1/%</li>
<li>;%1/%%v0.5/%%blackrect%</li>
<li>;%1/%</li>
<li>;%5/%%v0.5/%%blackrect%</li>
<li>;%5/%%v1/%</li>
<li>;%5/%%v0.5/%%blackrect%</li>
<li>;%5/%%v1/%</li>
<li>;%5/%%v0.5/%%blackrect%</li>
<li>;%5/%%v1/%</li>
<li>;%5/%%v0.5/%%blackrect%</li>
<li>;%5/%%v1/%</li>
<li>;%5/%%v0.5/%%blackrect%</li>
<li>%1/%%v0.5/%%blackrect%</li>
<li>;%1/%</li>
<li>;%1/%%v0.5/%%blackrect%</li>
<li>;%1/%</li>
<li>;%1/%%v0.5/%%blackrect%</li>
<li>;%5/%</li>
<li>;%5/%%v0.5/%%blackrect%</li>
<li>;%5/%</li>
<li>;%5/%%v0.5/%%blackrect%</li>
<li>;%5/%</li>
<li>;%5/%%v0.5/%%blackrect%</li>
<li>;%5/%</li>
<li>;%5/%%v0.5/%%blackrect%</li>
<li>%v0.8/%</li>
<li>%4.5/%0m</li>
<li>;%5/%5m</li>
<li>;%10/%10m</li>
<li>;%10/%20m</li>
<li>;%10/%30m</li>
<li>;%10/%40m</li>
<li>;%10/%50m</li>
</ul></tt>

<p>North arrow:</p>
<tt><ul>
<li>N</li>
<li>%t1/0.1%%v0/%%h0/%</li>
<li>;%v3/%%t0/%%h2/%%whiterect%</li>
<li>%t1/%%v0/%%h0/%</li>
<li>;%v3/%%t0/%%h1/%%blackrect%</li>
</ul></tt>

<p>Depth scale bar:</p>
<tt><ul>
<li>%10/3%%v50/%%blackrect%</li>
<li>;1800m</li>
<li>%10/%%v50.0/%%whiterect%</li>
<li>;1600m</li>
<li>%10/%%v50/%%blackrect%</li>
<li>;1500m</li>
<li>%10/%%v50.0/%%whiterect%</li>
<li>;1400m</li>
<li>%10/%%v50/%%blackrect%</li>
<li>;1300m</li>
<li>%10/%%v50.0/%%whiterect%</li>
<li>;1200m</li>
<li>%10/%%v50/%%blackrect%</li>
<li>;1100m</li>
<li>%10/%%v0/%</li>
<li>;1700m</li>
</ul></tt>

<p>The <b>';'</b> at the start of the line means the block stays on the same row.  
(each new line is displaced down by the vertical height of the first block).
The code <b>'%X/Y%'</b> at the beginning of a block makes it have a width of <em>X/Y</em> metres, 
while <b>'%vX/Y'</b> sets its height.  
(If <b>'Y'</b> is left out, then it takes the previous value, so in the first example 
the 50m scale bar can be converted to a 500m scale bar by changing <tt>1.0000</tt> to <tt>0.1</tt> in the first line.)</p>

<p>The symbols <b>'%whiterect%'</b> and <b>'%blackrect%'</b> fill the block with an outline or a filled in rectangle.
Alternatively, place text here and use the blocks to define the cells of a table.</p>

<p>The top and bottom widths of a block can be set independently with <b>'%tX/Y'</b> for the top and <b>'%hX/Y'</b> for the bottom (the 'h' is optional) 
to produce triangles or parallelograms.</p>


<h1>Subsets</h1>

<p>The current subset can be selected from the tree view in <b>subs</b> tab.  
Select a colour beneath the '<tt>visiblesets</tt>' and all the paths will turn grey.
Select a path (<em>Mouse Right</em>) or an area (<em>Shift+Mouse Right</em>) and 
click <b>Add to Subset</b> to make it appear in the subset.  
Labels should be added to the subset, but their colours will only show after 
clicking <b>Detail Render</b>.

<p>Do <b>Clear subset selection</b> to undo the subset selection.  
The subsets of a selected path appears in the drop-down box at the bottom, 
which can be used for quick selection of an individual subset.</p>

<p>Named subsets can be made by making a <em>Connective</em> path, 
clicking <b>Area signal</b>, and choosing <em>frame</em> from the 
drop-down box.  Above the line <tt>'&lt;/sketchframe&gt;'</tt> (the last line), 
insert:</p>

<ul><li>
<tt>&lt;subsetattr uppersubset="blue" name="Secret Grotto"/&gt;</tt>
</li></ul>

<p>... then click <b>Copy</b>.  The tree view in the lower window will now have 
'<tt>(Secret Grotto)</tt>' beneath '<tt>visiblesets</tt>' -&gt; '<tt>blue</tt>'.  
Select it to add paths and areas to the 'Secret Grotto' subset.  
The colour can be altered later by changing the value of '<tt>uppersubset</tt>'.
The colour set when '<tt>name="default"</tt>' applies to all remaining areas.</p>



<h1>Frame</h1>

<p>Start a new empty sketch, and make a <em>Connective</em> path, 
click <b>Area signal</b> 
and selecting <em>frame</em> from the drop-down box.  
Now click <b>Import</b> -&gt; <b>Import paper</b> -&gt; <b>Make A1</b> 
to create an <em>A1</em> size sheet of paper.</p>

<p>Draw a rectangle in it, make a path into it, and make it <em>frame</em> type too.
Now we can add another sketch to it, apply Max, move it around into position, 
set its colours, and render it.</p>

<p>It's possible to render the same survey at two different scales in the same 
area with different subset styles overlaid on a aerial photo or bitmap of a map.</p>

<p>Also put in all the title box and other clobber in this, so as not to clutter 
the main survey with it.  Use <em>subset style</em> <tt>baseA3page</tt> or similar to 
find a new set of fonts.</p>

<p>Images can be placed inside areas (as well as other sketches) where they will be trimmed.  
This allows for background overlays of aerial imagery.</p>

<p>Multiple sketchs can appear in the same window, where the order is controlled by setting 
the <em>nodeconnzsetrelative</em> values.</p>


<h1>Elevations</h1>

<p><em>Provisional owing to user interface difficulties</em></p>

<p>Drawings for cross sections and extended elevations are tied to a 
<em>Connective</em> path by all being in a subset of name "XC stationname" or "ELEV stationname1 stationname2".</p>

<p>To make a cross section, draw a <em>Connective</em> line from a node in one wall across the passage 
into a node in the other wall.  Then (with the path selected) do <b>Elevation</b> -&gt; <b>XC Subset</b> to 
create the new subset (with a name of the form "XC something") and the axis of the cross section 
(as a disconnected centreline piece).  Move and fit this axis to the cross section (using <b>Fuse</b> and <b>Component</b>) 
and then draw around the cross section (connecting it to the axis).  
Note that an arrow pointer moves along the corresponding path cutting the passage for the purpose of lining up features 
between the plan and the cross section.</p>

<p>To make an extended elevation, draw a <em>Connective</em> line from a centreline node (or a node immediately connected to a centreline) 
to another such node, then do <b>Elevation</b> -&gt; <b>Elevation Subset</b> to generate a long centreline path 
for use as the axis in the elevation drawing.</p>

<p>After the elevation has been drawn (with all the paths in the "ELEV" subset), the endpoint of the centreline axis 
can be moved (using <b>Fuse</b>) to stretch and fit the pieces together.</p>

<p>Use the <b>img</b> tab to see what is happening when the elevation/cross section drawing and corresponding 
place in the plan are too far apart to show in the same graphics area at a resonable scale.</p>


<h1>Printing</h1>

<p>The <b>print</b> tab enables output to PNG or JPG type images, which can then be printed 
using standard image handling software.  The printing area is either the bounding box for 
the currently selected subset (set through the <b>subs</b> tab), or the viewable graphics area.
Select the subset for the <em>A1 frame</em> to produce a consistent result.</p>

<p>The dimensions stated in <em>Real dimensions:</em> correspond to a 
baseline scale of <tt>1:1000</tt>, so a 500m wide cave will be 50cm on the paper.  
Vary the pixel dimensions by changing the resolution in dots per inch (on this 1:1000 paper).</p>

<p>The directory for output and name of file are listed below.</p>

<p>Because the same sketch may appear as in different <em>subset styles</em>, 
a proper rendering may require the symbols to be layed out multiple times.  
Select <em>Full draw</em> to enable this, or preview using one of the 
lesser modes.</p>

<p>Other options include output to <em>Gray scale</em> and <em>Transparent</em> colour to make the white 
areas alpha=0 for use in other graphics packages.</p>

<p><em>Requires re-implementation:</em> If the centreline is in the right coordinate space, click on 
<b>Overlay</b> to render it and upload it to the cave map overlay automatically, for maximum 
speed of publication.</p>


<h1>Command line</h1>

<p>To compile do:</p>
<p><tt>"C:\Program Files\Java\jdk1.6.0_26\bin\javac" -target 1.5 -Xlint:deprecation -d . src\*.java</tt></p>
<p>To run do:</p>
<p><tt>java -showversion -ea -Xmx1000M -cp . Tunnel.MainBox C:\\Users\\goatchurch\\tunneldata\\</tt></p>

<p>Other options:</p>
<ul>
<li><tt>--verbose</tt></li>
<li><tt>--quiet</tt></li>
<li><tt>--todenode</tt></li>
<li><tt>--netconnection</tt></li>
<li><tt>--makeimages</tt> Automatically generates images from all the areas that have an areasignal of frame and subset "framestyle"</li>
<li><tt>--printdir=</tt></li>
<li><tt>--twotone</tt> Forces a grey scale which is mapped to black and white pixels at a threshold of 65000</li>
</ul>


<h1>Main - Start here</h1>

<p>Welcome to TunnelX, a free Cave drawing system that depends on Survex and which does the 
same thing as Therion, except completely different.</p>

<p>This is the main window, which keeps track of your files as you are working on them.  
There is a second window which is the drawing area.</p>

<p>If this is your first time using TunnelX, you may want to try loading the Tutorials by clicking on 
<b>File</b> -&gt; <b>Open tutorials</b>.</p>

<p>Project development directory is <b>https://bitbucket.org/goatchurch/tunnelx</b></p>

<p>Updated 2011-07-24</p>